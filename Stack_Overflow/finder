#!/bin/bash

if [ -z $1 ] 
then
	echo "Usage: ./finder relative_program_path";
	exit;
fi

if [ ! -x $1 ]
then
 	echo "File not executable or not found"
 	exit;
fi

# TO DO: IMPLEMENT BINARY SEARCH FOR THE BUFFER OVERFLOW, ADD ALPHABET TO FIND THE OFFSET WITH EASE

echo "Overflowing with \"A\""
program="$1";
let i=0;
x="";
while [ -z "$x" ] 
do
	let "i+=4"
	cmd="print(\"A\"*$(echo $i))"
	x=`python -c $cmd | strace $program 2>&1 | grep -oh "\w*si_addr=0\w*"`
done


echo "Found overflow at offset $i: $x"

y=$x

while true 
do
	let "i+=1"
	cmd="print(\"A\"*$(echo $i))"
	x=`python -c $cmd | strace $program 2>&1 | grep -oh "\w*si_addr=0\w*"`
	if [ "$x" == "$y" ] 
		then break
	fi
	echo "At offset $i: $x"
	y=$x
done

let "i-=5"

echo "Predicted offset: $i"